name: 'Create Pull Request'
description: 'Creates a pull request using GitHub CLI'
inputs:
  title:
    description: 'Title of the pull request'
    required: true
  body:
    description: 'Body of the pull request'
    required: true
  base:
    description: 'Base branch for the pull request'
    required: true
  head:
    description: 'Head branch for the pull request'
    required: true
  github-token:
    description: 'GitHub token for authentication'
    required: true
  draft:
    description: 'Create the pull request as a draft'
    required: false
    default: 'false'
  labels:
    description: 'Comma-separated list of labels to add'
    required: false
  assignees:
    description: 'Comma-separated list of assignees'
    required: false
  reviewers:
    description: 'Comma-separated list of reviewers'
    required: false
outputs:
  pr-url:
    description: 'URL of the created pull request'
    value: ${{ steps.create.outputs.pr_url }}
  pr-number:
    description: 'Number of the created pull request'
    value: ${{ steps.create.outputs.pr_number }}

runs:
  using: 'composite'
  steps:
    - name: Create Pull Request
      id: create
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github-token }}
        PR_TITLE: ${{ inputs.title }}
        PR_BODY: ${{ inputs.body }}
        PR_BASE: ${{ inputs.base }}
        PR_HEAD: ${{ inputs.head }}
        PR_DRAFT: ${{ inputs.draft }}
        PR_LABELS: ${{ inputs.labels }}
        PR_ASSIGNEES: ${{ inputs.assignees }}
        PR_REVIEWERS: ${{ inputs.reviewers }}
      run: |
        ARGS=(gh pr create --title "$PR_TITLE" --body "$PR_BODY" --base "$PR_BASE" --head "$PR_HEAD")

        if [[ "$PR_DRAFT" == "true" ]]; then
          ARGS+=(--draft)
        fi

        if [[ -n "$PR_LABELS" ]]; then
          ARGS+=(--label "$PR_LABELS")
        fi

        if [[ -n "$PR_ASSIGNEES" ]]; then
          ARGS+=(--assignee "$PR_ASSIGNEES")
        fi

        if [[ -n "$PR_REVIEWERS" ]]; then
          ARGS+=(--reviewer "$PR_REVIEWERS")
        fi

        PR_URL=$("${ARGS[@]}")
        echo "pr_url=${PR_URL}" >> $GITHUB_OUTPUT
        PR_NUMBER=$(echo "$PR_URL" | awk -F'/' '{print $NF}')
        echo "pr_number=${PR_NUMBER}" >> $GITHUB_OUTPUT
        echo "Created PR: ${PR_URL}" | tee -a $GITHUB_STEP_SUMMARY
